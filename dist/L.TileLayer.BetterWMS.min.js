L.TileLayer.BetterWMS=L.TileLayer.WMS.extend({onAdd:function(t){L.TileLayer.WMS.prototype.onAdd.call(this,t),t.on("click",this.getFeatureInfo,this)},onRemove:function(t){L.TileLayer.WMS.prototype.onRemove.call(this,t),t.off("click",this.getFeatureInfo,this)},getFeatureInfo:function(s){var t=this.getFeatureInfoUrl(s.latlng),a=L.Util.bind(this.showGetFeatureInfo,this);$.ajax({url:t,success:function(t,e,r){var n="string"==typeof t?null:t;0<(new DOMParser).parseFromString(t,"text/html").body.innerHTML.trim().length&&a(n,s.latlng,t)},error:function(t,e,r){a(r)}})},getFeatureInfoUrl:function(t){var t=this._map.latLngToContainerPoint(t,this._map.getZoom()),e=this._map.getSize(),e={request:"GetFeatureInfo",service:"WMS",srs:"EPSG:4326",styles:this.wmsParams.styles,transparent:this.wmsParams.transparent,version:this.wmsParams.version,format:this.wmsParams.format,bbox:this._map.getBounds().toBBoxString(),height:e.y,width:e.x,layers:this.wmsParams.layers,query_layers:this.wmsParams.layers,info_format:"text/html"};return e["1.3.0"===e.version?"i":"x"]=Math.floor(t.x),e["1.3.0"===e.version?"j":"y"]=Math.floor(t.y),this._url+L.Util.getParamString(e,this._url,!0)},showGetFeatureInfo:function(t,e,r){t?console.log(t):L.popup({maxWidth:800}).setLatLng(e).setContent(r).openOn(this._map)}}),L.tileLayer.betterWms=function(t,e){return new L.TileLayer.BetterWMS(t,e)};